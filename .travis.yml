before_install:
  - |

    declare -r SSH_FILE="$(mktemp -u $HOME/.ssh/github_deploy_key)"

    # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

    # Decrypt the file containing the private key
    # (Note: this is the same as what is generated by the Travis CLI at step 2.5)

    openssl aes-256-cbc \
     -K $encrypted_c0f12bd67831_key \
     -iv $encrypted_c0f12bd67831_iv \
     -in ".travis/github_deploy_key.enc" \
     -out "$SSH_FILE" -d

    # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

    # Enable SSH authentication

    chmod 600 "$SSH_FILE" && \
    printf "%s\n" \
        "Host github.com" \
        "  IdentityFile $SSH_FILE" \
        "  LogLevel ERROR" >> ~/.ssh/config

script:
  - make deploy
